# ============================================================
# Pre-commit Hooks Configuration - Gitmoji Compatible
# ============================================================
# Ce fichier configure les hooks Git pour validation automatique
# avant chaque commit.
#
# Installation: make install
# Usage: Les hooks s'exÃ©cutent automatiquement Ã  chaque git commit
# Bypass (urgence): git commit --no-verify
# ============================================================

repos:
  # ============================================================
  # 1. COMMITLINT - Validation des messages de commit
  # ============================================================
  - repo: https://github.com/alessandrojcm/commitlint-pre-commit-hook
    rev: v9.5.0
    hooks:
      - id: commitlint
        stages: [commit-msg]
        additional_dependencies:
          - '@commitlint/config-conventional'
          - 'commitlint-config-gitmoji'
        args: ['--config', 'commitlint.config.js']

  # ============================================================
  # 2. PYTHON CODE QUALITY
  # ============================================================

  # Black - Formatage automatique du code Python
  - repo: https://github.com/psf/black
    rev: 24.1.1
    hooks:
      - id: black
        language_version: python3.12
        args: ['--line-length=100']

  # Flake8 - Linter Python (PEP8 + complexitÃ©)
  - repo: https://github.com/pycqa/flake8
    rev: 7.0.0
    hooks:
      - id: flake8
        args:
          - '--max-line-length=100'
          - '--extend-ignore=E203,W503'  # Compatible avec Black
          - '--max-complexity=10'
        additional_dependencies:
          - flake8-docstrings
          - flake8-bugbear

  # isort - Tri automatique des imports
  - repo: https://github.com/PyCQA/isort
    rev: 5.13.2
    hooks:
      - id: isort
        args: ['--profile', 'black', '--line-length', '100']

  # ============================================================
  # 3. SÃ‰CURITÃ‰
  # ============================================================

  # Bandit - DÃ©tection de vulnÃ©rabilitÃ©s de sÃ©curitÃ©
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.6
    hooks:
      - id: bandit
        args: ['-c', 'pyproject.toml']
        additional_dependencies: ['bandit[toml]']

  # Detect-secrets - DÃ©tection de secrets/credentials
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.4.0
    hooks:
      - id: detect-secrets
        args: ['--baseline', '.secrets.baseline']
        exclude: package.lock.json

  # ============================================================
  # 4. FICHIERS & FORMATAGE GÃ‰NÃ‰RAL
  # ============================================================

  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # Supprime les espaces en fin de ligne
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]

      # Assure qu'il y a une ligne vide Ã  la fin des fichiers
      - id: end-of-file-fixer

      # VÃ©rifie la syntaxe YAML
      - id: check-yaml
        args: ['--unsafe']  # NÃ©cessaire pour docker-compose

      # VÃ©rifie la syntaxe JSON
      - id: check-json

      # VÃ©rifie la syntaxe TOML
      - id: check-toml

      # EmpÃªche les gros fichiers d'Ãªtre commitÃ©s (>500KB)
      - id: check-added-large-files
        args: ['--maxkb=500']

      # DÃ©tecte les conflits de merge non rÃ©solus
      - id: check-merge-conflict

      # VÃ©rifie que les fichiers parsent correctement
      - id: check-ast

      # DÃ©tecte les clÃ©s dupliquÃ©es dans JSON/YAML
      - id: check-json
      - id: check-yaml

      # EmpÃªche de commiter directement sur main (optionnel)
      # - id: no-commit-to-branch
      #   args: ['--branch', 'main', '--branch', 'master']

  # ============================================================
  # 5. DOCKER
  # ============================================================

  # Hadolint - Linter pour Dockerfile
  - repo: https://github.com/hadolint/hadolint
    rev: v2.12.0
    hooks:
      - id: hadolint-docker
        args: ['--ignore', 'DL3008', '--ignore', 'DL3013']

  # ============================================================
  # 6. MARKDOWN
  # ============================================================

  # Markdownlint - Linter pour fichiers Markdown
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.39.0
    hooks:
      - id: markdownlint
        args: ['--fix']

# ============================================================
# CONFIGURATION GLOBALE
# ============================================================
default_language_version:
  python: python3.12

# Exclure certains fichiers/dossiers
exclude: |
  (?x)^(
    \.git/|
    \.venv/|
    venv/|
    __pycache__/|
    \.pytest_cache/|
    \.mypy_cache/|
    dist/|
    build/|
    \.eggs/|
    logs/|
    CHANGELOG\.md|
    \.secrets\.baseline
  )$

# ============================================================
# NOTES D'UTILISATION
# ============================================================
# Installation:
#   make install
#   OU
#   pip install pre-commit
#   pre-commit install --hook-type commit-msg
#   pre-commit install --hook-type pre-commit
#
# ExÃ©cution manuelle:
#   pre-commit run --all-files
#
# Bypass (urgence uniquement):
#   git commit --no-verify -m "ðŸš‘ Hotfix: Critical bug"
#
# Mise Ã  jour des hooks:
#   pre-commit autoupdate
# ============================================================
